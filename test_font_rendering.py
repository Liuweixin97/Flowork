#!/usr/bin/env python3
"""æµ‹è¯•PDFå­—ä½“æ¸²æŸ“"""

import requests
import json

# æµ‹è¯•æ•°æ® - åŒ…å«ä¸­æ–‡å†…å®¹çš„ç®€å†
test_resume_data = {
    "title": "æµ‹è¯•ç®€å† - ä¸­æ–‡å­—ä½“æ¸²æŸ“",
    "resume_markdown": """# å¼ ä¸‰
**è½¯ä»¶å·¥ç¨‹å¸ˆ**

ğŸ“§ zhangsan@example.com | ğŸ“± 138-0000-0000 | ğŸ“ åŒ—äº¬å¸‚æµ·æ·€åŒº

## å·¥ä½œç»éªŒ

### é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆ | ABCç§‘æŠ€å…¬å¸ | 2020.01 - è‡³ä»Š
- è´Ÿè´£æ ¸å¿ƒäº§å“çš„æ¶æ„è®¾è®¡å’Œå¼€å‘å·¥ä½œ
- å¸¦é¢†5äººå›¢é˜Ÿå®Œæˆå¤šä¸ªé‡è¦é¡¹ç›®äº¤ä»˜
- ä½¿ç”¨Pythonã€JavaScriptç­‰æŠ€æœ¯æ ˆå¼€å‘Webåº”ç”¨
- å®ç°äº†ç³»ç»Ÿæ€§èƒ½æå‡30%çš„ä¼˜åŒ–æ–¹æ¡ˆ

### è½¯ä»¶å·¥ç¨‹å¸ˆ | XYZå…¬å¸ | 2018.06 - 2019.12
- å‚ä¸å…¬å¸ä¸»è¦äº§å“çš„åŠŸèƒ½å¼€å‘å’Œç»´æŠ¤
- ååŠ©å›¢é˜Ÿå®ŒæˆæŠ€æœ¯æ ˆå‡çº§å·¥ä½œ
- è´Ÿè´£ç¼–å†™æŠ€æœ¯æ–‡æ¡£å’Œç”¨æˆ·æ‰‹å†Œ

## æ•™è‚²èƒŒæ™¯

### è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯å­¦å£« | æ¸…åå¤§å­¦ | 2014.09 - 2018.06
- ä¸»ä¿®è¯¾ç¨‹ï¼šæ•°æ®ç»“æ„ã€ç®—æ³•è®¾è®¡ã€è½¯ä»¶å·¥ç¨‹ã€æ•°æ®åº“ç³»ç»Ÿ
- GPA: 3.8/4.0
- è·å¾—ä¼˜ç§€æ¯•ä¸šç”Ÿç§°å·

## æŠ€èƒ½ç‰¹é•¿

### ç¼–ç¨‹è¯­è¨€
- Pythonï¼šç²¾é€šï¼Œ5å¹´å¼€å‘ç»éªŒ
- JavaScriptï¼šç†Ÿç»ƒï¼Œèƒ½å¤Ÿå¼€å‘å‰åç«¯åº”ç”¨
- Javaï¼šäº†è§£ï¼Œæ›¾å‚ä¸ä¼ä¸šçº§é¡¹ç›®å¼€å‘
- SQLï¼šç†Ÿç»ƒï¼Œå…·å¤‡æ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–ç»éªŒ

### æ¡†æ¶å’Œå·¥å…·
- Djangoã€Flaskï¼šPython Webå¼€å‘æ¡†æ¶
- Reactã€Vue.jsï¼šå‰ç«¯å¼€å‘æ¡†æ¶
- Dockerã€Kubernetesï¼šå®¹å™¨åŒ–å’Œéƒ¨ç½²å·¥å…·
- Gitã€Jenkinsï¼šç‰ˆæœ¬æ§åˆ¶å’ŒæŒç»­é›†æˆ

## é¡¹ç›®ç»å†

### ä¼ä¸šçº§å®¢æˆ·ç®¡ç†ç³»ç»Ÿ | 2021.03 - 2021.08
**é¡¹ç›®æè¿°ï¼š** ä¸ºä¼ä¸šå®¢æˆ·å¼€å‘çš„CRMç³»ç»Ÿï¼Œæ”¯æŒå®¢æˆ·ä¿¡æ¯ç®¡ç†ã€é”€å”®è·Ÿè¿›ã€æ•°æ®åˆ†æç­‰åŠŸèƒ½ã€‚

**æŠ€æœ¯æ ˆï¼š** Python, Django, PostgreSQL, Redis, React

**ä¸»è¦è´¡çŒ®ï¼š**
- è®¾è®¡å¹¶å®ç°äº†ç³»ç»Ÿçš„æ ¸å¿ƒæ¶æ„
- å¼€å‘äº†ç”¨æˆ·æƒé™ç®¡ç†æ¨¡å—
- å®ç°äº†å®æ—¶æ•°æ®åŒæ­¥åŠŸèƒ½
- ç³»ç»Ÿä¸Šçº¿åè·å¾—å®¢æˆ·é«˜åº¦è®¤å¯

### æ™ºèƒ½æ¨èç®—æ³•ä¼˜åŒ– | 2020.05 - 2020.10
**é¡¹ç›®æè¿°ï¼š** ä¼˜åŒ–ç”µå•†å¹³å°çš„å•†å“æ¨èç®—æ³•ï¼Œæé«˜æ¨èå‡†ç¡®ç‡å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚

**æŠ€æœ¯æ ˆï¼š** Python, Machine Learning, TensorFlow, Apache Spark

**ä¸»è¦è´¡çŒ®ï¼š**
- åˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œæ”¹è¿›æ¨èæ¨¡å‹
- å®ç°äº†åŸºäºæ·±åº¦å­¦ä¹ çš„æ¨èç®—æ³•
- æ¨èç‚¹å‡»ç‡æå‡äº†25%
- ç”¨æˆ·å¹³å‡åœç•™æ—¶é—´å¢åŠ äº†15%

## è¯ä¹¦å’Œè£èª‰

- AWSè®¤è¯è§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆ (2021)
- å…¬å¸å¹´åº¦æœ€ä½³å‘˜å·¥ (2020)
- å…¨å›½å¤§å­¦ç”Ÿç¨‹åºè®¾è®¡ç«èµ›ä¸‰ç­‰å¥– (2017)

## ä¸ªäººä¿¡æ¯

- å¹´é¾„ï¼š28å²
- å·¥ä½œç»éªŒï¼š6å¹´
- æœŸæœ›è–ªèµ„ï¼š25-30K
- å¯å…¥èŒæ—¶é—´ï¼šéšæ—¶
"""
}

def test_pdf_generation():
    """æµ‹è¯•PDFç”ŸæˆåŠŸèƒ½"""
    try:
        print("ğŸ§ª å¼€å§‹æµ‹è¯•PDFç”ŸæˆåŠŸèƒ½...")
        print("ğŸ“ æµ‹è¯•æ•°æ®åŒ…å«ä¸°å¯Œçš„ä¸­æ–‡å†…å®¹")
        
        # å‘é€è¯·æ±‚åˆ°åç«¯API
        response = requests.post(
            'http://localhost:8080/api/resumes/from-dify',
            json=test_resume_data,
            headers={'Content-Type': 'application/json'}
        )
        
        if response.status_code == 200:
            result = response.json()
            print(f"âœ… ç®€å†åˆ›å»ºæˆåŠŸ!")
            print(f"ğŸ“„ ç®€å†ID: {result.get('id')}")
            print(f"ğŸ“ ç®€å†æ ‡é¢˜: {result.get('title')}")
            
            # æµ‹è¯•PDFä¸‹è½½
            if result.get('id'):
                pdf_response = requests.get(f"http://localhost:8080/api/resumes/{result['id']}/pdf")
                if pdf_response.status_code == 200:
                    # ä¿å­˜PDFæ–‡ä»¶
                    with open('test_font_rendering.pdf', 'wb') as f:
                        f.write(pdf_response.content)
                    print(f"âœ… PDFç”ŸæˆæˆåŠŸ! æ–‡ä»¶å·²ä¿å­˜ä¸º: test_font_rendering.pdf")
                    print(f"ğŸ“Š PDFæ–‡ä»¶å¤§å°: {len(pdf_response.content)} å­—èŠ‚")
                    
                    # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„å­—ä½“
                    print(f"ğŸ”¤ ä½¿ç”¨å­—ä½“: HelveticaCJK (ç³»ç»Ÿå­—ä½“)")
                    print(f"ğŸ’¡ æç¤º: è¯·æ‰“å¼€ç”Ÿæˆçš„PDFæ–‡ä»¶æ£€æŸ¥ä¸­æ–‡å­—ç¬¦æ¸²æŸ“æ•ˆæœ")
                    
                    return True
                else:
                    print(f"âŒ PDFä¸‹è½½å¤±è´¥: {pdf_response.status_code}")
                    print(f"é”™è¯¯ä¿¡æ¯: {pdf_response.text}")
            
        else:
            print(f"âŒ ç®€å†åˆ›å»ºå¤±è´¥: {response.status_code}")
            print(f"é”™è¯¯ä¿¡æ¯: {response.text}")
            
    except Exception as e:
        print(f"âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: {e}")
        
    return False

if __name__ == "__main__":
    print("ğŸš€ PDFå­—ä½“æ¸²æŸ“æµ‹è¯•")
    print("=" * 50)
    
    success = test_pdf_generation()
    
    print("=" * 50)
    if success:
        print("ğŸ‰ æµ‹è¯•å®Œæˆ! è¯·æ£€æŸ¥ç”Ÿæˆçš„PDFæ–‡ä»¶ä¸­çš„ä¸­æ–‡å­—ç¬¦æ¸²æŸ“æ•ˆæœ")
        print("ğŸ“‚ ç”Ÿæˆçš„æ–‡ä»¶: test_font_rendering.pdf")
    else:
        print("ğŸ˜ æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯")